---
import Layout from '../layouts/Layout.astro';
---
<Layout title="이메일 인증">
  <div class="max-w-md mx-auto py-16 px-4 text-center" id="verify-container">
    <div class="text-gray-500">인증 중...</div>
  </div>
</Layout>

<script>
  const params = new URLSearchParams(window.location.search);
  const token = params.get('token');
  const container = document.getElementById('verify-container')!;

  if (!token) {
    container.innerHTML = '<h2 class="text-xl font-bold text-red-600">유효하지 않은 링크입니다</h2>';
  } else {
    fetch(`/api/auth/verify-email?token=${token}`)
      .then(r => r.json())
      .then(data => {
        if (data.message) {
          container.innerHTML = `
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
            </div>
            <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-2">이메일 인증 완료!</h2>
            <p class="text-gray-500 dark:text-gray-400 mb-6">${data.message}</p>
            <a href="/" class="inline-block py-3 px-6 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg transition-colors">
              메인으로 돌아가기
            </a>
          `;
        } else {
          container.innerHTML = `<h2 class="text-xl font-bold text-red-600">인증 실패: ${data.error || '알 수 없는 오류'}</h2>`;
        }
      })
      .catch(() => {
        container.innerHTML = '<h2 class="text-xl font-bold text-red-600">인증 중 오류가 발생했습니다</h2>';
      });
  }
</script>
